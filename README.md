# web_template ğŸ”¥ğŸ”¥ğŸ”¥
    åŸºäº REACT+WEBPACK+TYPESCRIPT å®ç°çš„webè„šæ‰‹æ¶,ç›®çš„æ˜¯é€šè¿‡æä¾›ä¸€ç³»åˆ—é€šç”¨å·¥å…·å¹¶é›†åˆé¡¹ç›®å¼€å‘å„ç¯èŠ‚çš„æœ€ä½³å®è·µï¼Œæ–¹ä¾¿ç®€å•å¿«é€Ÿçš„å¼€å‘webé¡¹ç›®ã€‚  

æµ…æ¡†æ¶æä¾›:
- åŸºç¡€çš„webpacké…ç½®
- å¤šå…¥å£é¡¹ç›®é…ç½®(ç±»ä¼¼env)
- æ•°æ®ä¸­å¿ƒ(çŠ¶æ€ç®¡ç†&äº‹ä»¶é€šä¿¡ä¸­å¿ƒ)
- å†…ç½®å¸¸ç”¨å…¬ç”¨reactç»„ä»¶
- å¯é€‰æ‹“å±•é…ç½®(axiosç­‰)
- å¸¸è§„éœ€æ±‚åŠŸèƒ½æ ·ä¾‹é›†

## æ ¸å¿ƒåŠŸèƒ½
### 1.æµ…æ¡†æ¶- å¯åŠ¨
ReactåŸå…¥å£
``ReactDOM.render(root, document.getElementById("root"));`` 
å¯¹åº”å¯åŠ¨å…¥å£å¦‚ä¸‹ï¼š
```
MyApp.start(<APP />,{
    //ï¼ˆå¯é€‰ï¼‰ è®¾ç½®å½“å‰é¡¹ç›®ç¯å¢ƒï¼Œè¦†ç›–é»˜è®¤ç¯å¢ƒï¼ˆTip: app_configè·Ÿç€ç¯å¢ƒèµ°ï¼‰
    appEnv:"prod";
    //ï¼ˆå¯é€‰ï¼‰ é…ç½®æ•°æ®ä¸­å¿ƒï¼Œè¯¦æƒ…è§ä¸‹é¢ 2.æ•°æ®ä¸­å¿ƒï¼ˆAPP_STOREï¼‰ç®¡ç†
    storeData:{}
    storeOpt:{}
    //ï¼ˆå¯é€‰ï¼‰ å¯åŠ¨çš„æ—¶å€™å¹²äº›äº‹æƒ…
    onInit: () => {};
    //ï¼ˆå¯é€‰ï¼‰æ”¹å†™domain
    appDomain:"xx"
});
```

æä¾›å…¨å±€å˜é‡ï¼š
```
    - APP_VERSIONï¼š é¡¹ç›®ç‰ˆæœ¬ä¿¡æ¯
    - APP_ENVï¼š     é¡¹ç›®ç¯å¢ƒï¼ˆ"prod" | "test" | "dev"ï¼‰
    - APP_CONFIGï¼š  é¡¹ç›®é…ç½®
    - APP_STORE:    é¡¹ç›®æ•°æ®ä¸­å¿ƒ
```

### 2.æµ…æ¡†æ¶-é¡¹ç›®é…ç½®ï¼ˆAPP_CONFIGï¼‰ ç®¡ç† âš™âš™âš™
    é¡¹ç›®çš„é…ç½®ç”±å¤šä¸ªé…ç½®å…¥å£çš„é…ç½®ç»„åˆä¸ºæœ€ç»ˆçš„APP_CONFIG. 
é…ç½®å…¥å£å¦‚ä¸‹ï¼š
>  a.(å¯é€‰)å…¬æœ‰é…ç½®(public->public_app_config.js)  
>  b.(å¯é€‰)ç§æœ‰é…ç½®(src->private_app_config.json)  
>  c.(å¯é€‰)Myapp.start çš„å¯åŠ¨å‚æ•° app_config

é…ç½®ä¼˜å…ˆçº§ï¼š  
> ç§æœ‰é…ç½®common < å…¬æœ‰é…ç½®common < ç§æœ‰é…ç½®å…·ä½“ç¯å¢ƒ < å…¬æœ‰é…ç½®å…·ä½“ç¯å¢ƒ < Myapp.start çš„å¯åŠ¨å‚æ•° app_config

å…¬/ç§æœ‰é…ç½®æ–‡ä»¶å›ºå®šç»“æ„:
```
    common:   å„ç¯å¢ƒcommoné…ç½®  
    dev:      å¼€å‘ä¸‹çš„é¡¹ç›®é…ç½®  
    test:     æµ‹è¯•ä¸‹çš„é¡¹ç›®é…ç½®  
    prod:     ç”Ÿäº§ä¸‹çš„é¡¹ç›®é…ç½®  
```

### 3.æµ…æ¡†æ¶-æ•°æ®ä¸­å¿ƒï¼ˆAPP_STOREï¼‰ç®¡ç†
APP_STOREæä¾›åŠŸèƒ½åŒ…å«:a. å…¨å±€å…±äº«æ•°æ®ç®¡ç† b.äº‹ä»¶é€šä¿¡ä¸­å¿ƒ c.æ•°æ®å­˜å‚¨ã€‚åŸºäºä»¥ä¸Šè¡ç”Ÿçš„åŠŸèƒ½ï¼šçŠ¶æ€ç®¡ç†(ç±»ä¼¼reduxï¼Œmobx)  

- æ•°æ®ä¸­å¿ƒåœ¨ä¸šåŠ¡ä¸­ä½¿ç”¨ï¼š
> 1. åœ¨ src-> config->customStore.ts ä¸­è®¾ç½® é¡¹ç›®æ•°æ®ä¸­å¿ƒéœ€è¦çš„æ•°æ®ï¼Œéœ€è¦å…³é—­å†æ‰“å¼€æˆ–åˆ·æ–°ä¾æ—§å­˜åœ¨çš„æ•°æ®éœ€è¦é€šè¿‡@attæ ‡æ³¨
> 2. åœ¨ src-> config->customStore.ts ä¸­å®šä¹‰ é¡¹ç›®éœ€è¦çš„é€šä¿¡äº‹ä»¶(æ–¹ä¾¿åœ¨ä½¿ç”¨APP_STORE.onå’Œ.emitçš„æ—¶å€™è·å–ç±»å‹æç¤ºï¼Œé»˜è®¤ï¼šany)ï¼Œ
> 3. æ•°æ®ä¸­å¿ƒåˆå§‹åŒ–é…ç½®é¡¹ï¼š ``MyApp.start å¯åŠ¨å‚æ•°ä¸­çš„ storeOpt å’Œ store_data``

Tip:
1. éœ€è¦è¢«å­˜å‚¨çš„æ•°æ®éœ€è¦ç”¨@attæ ‡è®°

- åŠŸèƒ½ä½¿ç”¨æƒ…æ™¯æ¼”ç¤ºä¸¾ä¾‹
1. ä½œä¸ºå…±äº«æ•°æ®ä¸­å¿ƒ
```
    let authinfo=APP_STORE.authInfo;//ä½¿ç”¨ å…±äº«çš„æ•°æ®
    APP_STORE.authInfo= {};//ä¿®æ”¹ å…±äº«çš„æ•°æ®
    APP_STORE.on("xxatt",(newValue,oldValue)=>{});// æ•°æ®ä¸­å¿ƒå±æ€§æ•°æ®äº‹ä»¶ç›‘å¬
    APP_STORE.on("attChange",(att,newValue,oldValue)=>{}); // æ•°æ®ä¸­å¿ƒä»»æ„å±æ€§æ•°æ®ä¿®æ”¹äº‹ä»¶ç›‘å¬
```
2. ä½œä¸ºäº‹ä»¶é€šä¿¡ä¸­å¿ƒ
```
    APP_STORE.on("login",(msg)=>{console.log(msg)})//äº‹ä»¶ç›‘å¬
    APP_STORE.emit("login","æˆ‘ç™»å½•äº†")//äº‹ä»¶ç›‘å¬
```

3. æ•°æ®å­˜å‚¨
    loadDataOnOpené»˜è®¤true,å³ä¼šå°†å­˜å‚¨çš„æ•°æ®ï¼ˆ@attæ ‡è®°çš„æ•°æ®ï¼‰åœ¨å¯åŠ¨çš„æ—¶å€™èµ‹å€¼ç»™storeï¼›
    saveItemToStorageé»˜è®¤ä¸ºnoneï¼Œé…ç½®ä¸ºæŸstorageå³ä¼šå°†storeçš„æ•°æ®æŒ‰ç…§å±æ€§å­˜åˆ°å¯¹åº”storageä¸­
```
    MyApp.start(<APP />, {
        //storeé…ç½®é¡¹ï¼ˆå¯é€‰ï¼‰
        storeOpt:{
            // ç›®æ ‡å¯¹è±¡;å¦‚æœä¸ºnull,å³ä¸º@MyStore æ ‡è®°çš„å¯¹è±¡
            target?: T;
            //storeåˆå§‹åŒ–å€¼;
            initData?: Partial<T>;
            // æ˜¯å¦å°†æ•°æ®å­˜å…¥Storage(å¯é€‰ï¼š"localStorage"ã€"sessionStorage"ã€"none")ï¼Œé»˜è®¤ï¼šâ€œnoneâ€
            saveItemToStorage: "localStorage";
            // å¯åŠ¨çš„æ—¶å€™åŠ è½½ä¸Šæ¬¡çš„æ•°æ®ï¼Œé»˜è®¤ï¼štrue
            loadDataOnOpen: false;
        },
    });
```
4. ä½œä¸ºçŠ¶æ€ç®¡ç†å™¨
```
    //classç»„ä»¶ä½¿ç”¨æä¾›çš„å¸®åŠ©å‡½æ•° mapAppStoreToProps
    @mapAppStoreToProps(["xxAtt"])
    export class ClassComp2 extends React.Component<{ xxAtt?: any }> {
        render() {
            return <div>ã€ClassComp2ã€‘xxAtt:{this.props.xxAtt}</div>
        }
    }
    //functionç»„ä»¶ä½¿ç”¨æä¾›çš„å¸®åŠ©å‡½æ•° useAppStore
    export function FuncComp2() {
        let storeAtt = useAppStore("xxAA");
        return <div>ã€FuncComp2ã€‘xxAA:{storeAtt}</div>
    }
```
5. ä¸ä½¿ç”¨@MyStore
```
    class XXStore {
        myAtt: string;
    }
    MyApp.start(<APP />, {
        storeOpt: {
            target: new XXStore()
        }
    });
```


### 4.å¯é€‰æ‹“å±•é…ç½®
    åœ¨ ``src/extends``æä¾›å„ç§é…ç½®ï¼Œåœ¨å…·ä½“é¡¹ç›®å¼€å‘çš„æ—¶å€™å¯ä»¥æŒ‰éœ€å¼•å…¥ã€‚ä¸éœ€è¦çš„æ‹“å±•å¯åœ¨ä¸€å¼€å§‹ç§»é™¤å¯¹åº”ä¾èµ–åŒ…
å·²æœ‰å¯é€‰é…ç½®åˆ—è¡¨ï¼š
> 1. extends/axios é…ç½®äº†axiosçš„å…¨å±€é…ç½®ä»¥åŠä¿®æ”¹äº†ç±»å‹æç¤ºã€‚ ç¬¬ä¸‰æ–¹ä¾èµ–ï¼šaxios
> 2. TODO: mqtt/websocketç­‰ä¸šåŠ¡å°è£…

å¯é€‰é…ç½®ä½¿ç”¨ä¸¾ä¾‹ï¼š
```
    MyApp.start(<APP />, {
        onInit: () => {
            initAxiosConfig()//ä½¿ç”¨ extends/axios æä¾›çš„é…ç½®
        }
    });
```

### 5.å…¬æœ‰ç»„ä»¶ä¸æ ·ä¾‹
> 1. PrivateRoute (è·³è½¬è·¯ç”±,éªŒè¯token),ä½¿ç”¨æ ·ä¾‹è§ï¼šexamples->privateRoute_1
> 2. LazyComp (æ‡’åŠ è½½ç»„ä»¶), ä½¿ç”¨æ ·ä¾‹è§ï¼šexamples->lazyComp_1ã€examples->lazyComp_2
> 3. examples->router_1ï¼šæ¼”ç¤ºè·¯ç”±é›†ä¸­é…ç½®(åŒ…å«å¤šçº§è·¯ç”±)
> 4. examples->appStoreï¼šæ¼”ç¤ºAPP_STOREå¸®åŠ©å‡½æ•°çš„ä½¿ç”¨(classç»„ä»¶ä¸functionç»„ä»¶)
> 5. examples->lazyComp_1ï¼šæ¼”ç¤ºlazyCompåŸºæœ¬ä½¿ç”¨
> 6. examples->lazyComp_2ï¼šæ¼”ç¤ºlazyCompé…åˆè·¯ç”±åšé¡µé¢bundleåˆ†å‰²
> 7. examples->privateRoute_1ï¼šæ¼”ç¤ºprivateRouteåšç•Œé¢æƒé™æ£€æŸ¥è·³è½¬

## æœ¬é¡¹ç›®å¿«é€Ÿä½¿ç”¨æµç¨‹
    1.é¡¹ç›®åˆå§‹åŒ–ã€‚
        1. ä»gitæ‹‰å–æœ¬é¡¹ç›®å,åˆ‡æ¢gitæºä¸ºè‡ªå·±çš„é¡¹ç›®gitåœ°å€ã€‚
        2. ä¿®æ”¹package.jsonä¸­é¡¹ç›®ä¿¡æ¯ã€‚
        3. æ¸…ç†æ‰ä¸éœ€è¦çš„ç›®å½•ã€æ–‡ä»¶å’Œç¬¬ä¸‰æ–¹ä¾èµ–åŒ…ï¼Œå³å¯æ‰§è¡Œ ``yarn`` å®Œæˆé¡¹ç›®åˆå§‹åŒ–.
    2. é¡¹ç›®å¼€å‘å‡†å¤‡
        1. æ ¹æ®é¡¹ç›®æƒ…å†µï¼Œå¯é€‰æ‹©åˆç†çš„ APP_CONFIGé…ç½®æ–¹å¼ï¼Œé…ç½®é¡¹ç›®éœ€è¦çš„ APIåœ°å€ç­‰ä¿¡æ¯
        2. åœ¨ ``src/config/customConfig.ts`` ä¸­é…ç½®APP_CONFIGçš„ç±»å‹ä¿¡æ¯
        3. åœ¨ ``src/config/customStore.ts`` ä¸­é…ç½®APP_STORE éœ€è¦çš„å…¨å±€æ•°æ®å’Œéœ€è¦çš„äº‹ä»¶ç±»å‹
        4. ä¿®æ”¹``MyApp.start`` å¯åŠ¨é¡¹
### 1. é¡¹ç›®æ­å»º - åŒ…ä¾èµ–
åŒ…ä¾èµ–:
```
    - "@mtgoo/ctool": "^0.0.16",// nodejså…¬å…±æ–¹æ³•åº“ï¼Œæœ¬æ¡†æ¶ä¾èµ–é‡Œé¢éƒ¨åˆ†æ–¹æ³•ï¼Œé¡¹ç›®å¼€å‘ä¸­ä¹Ÿå¯ä»¥æŒ‰éœ€å¼•å…¥
    - "axios": "^0.21.0",       // å¯é€‰é…ç½®ã€src/extends/axiosã€‘ ä¾èµ–çš„åŒ…
    - "react": "^16.12.0",
    - "react-dom": "^16.12.0",
    - "react-router-dom": "^5.2.0",//è·¯ç”±æ ·ä¾‹ ä¾èµ–çš„åŒ…
```

### 2. é¡¹ç›®æ­å»º - é¡¹ç›®ç»“æ„

æ–‡ä»¶ç›®å½•ä»‹ç»ï¼š
```
â”œâ”€ config                              # webpacké…ç½®ç®¡ç†ç›®å½•                   (å¿…é€‰ï¼Œå›ºå®šç›®å½•ï¼Œå¯æŒ‰éœ€å¢åŠ webpacké…ç½®)
â”œâ”€ public                              # é¡¹ç›®å…¬å…±èµ„æºç›®å½•                       (å¿…é€‰ï¼Œå›ºå®šç›®å½•,æŒ‰éœ€æ·»åŠ é¢å¤–èµ„æº)
|       â”œâ”€index.html                   # é¡¹ç›®htmlæ–‡ä»¶                          (å¿…é€‰ï¼Œå›ºå®šæ–‡ä»¶)
|       â”œâ”€public_app_config.js         # é¡¹ç›®å…¬å…±é…ç½®æ–‡ä»¶                       (å¿…é€‰ï¼Œå›ºå®šæ–‡ä»¶)
â”œâ”€ src                                 # é¡¹ç›®æºç ç›®å½•                           (å›ºå®šç›®å½•)
|       â”œâ”€__internal                   # é¡¹ç›®æ¡†æ¶æºç ç›®å½•                       (å¿…é€‰ï¼Œå›ºå®šç›®å½•)
|       â”œâ”€comps                        # é¡¹ç›®å…¬å…±ç»„ä»¶ç›®å½•                       (å¯é€‰ï¼Œæ¨èç›®å½•)
|       â”œâ”€config                       # é¡¹ç›®ï¼ˆapp_storeå’Œapp_configï¼‰è‡ªå®šä¹‰é…ç½®ç›®å½•    (å¿…é€‰ï¼Œå›ºå®šç›®å½•)
|       â”œâ”€examples                     # å…¬å…±ç»„ä»¶æ¼”ç¤ºå’ŒåŠŸèƒ½æ¼”ç¤ºæ ·ä¾‹ç›®å½•          (ä¸éœ€è¦)
|       â”œâ”€pages                        # é¡¹ç›®åˆ†é¡µç®¡ç†ç›®å½•                       (å¯é€‰ï¼Œæ¨èç›®å½•)
|       â”œâ”€extends                      # å¯é€‰æ‹“å±•é…ç½®ç®¡ç†ç›®å½•                    (å¯é€‰ï¼Œæ¨èç›®å½•)
|       â”œâ”€index.tsx                    # é¡¹ç›®å¯åŠ¨æ–‡ä»¶                           (å¿…é€‰ï¼Œå›ºå®šæ–‡ä»¶)
|       â”œâ”€private_app_config.json      # é¡¹ç›®ç§æœ‰é…ç½®æ–‡ä»¶                       (å¿…é€‰ï¼Œå›ºå®šæ–‡ä»¶)
â”œâ”€ .eslintrc.js                        # eslinté…ç½®æ–‡ä»¶                         (å¯é€‰ï¼Œæ¨è)
â”œâ”€ babel.config.js                     # babelé…ç½®æ–‡ä»¶                          (å¿…é€‰)
â”œâ”€ docker-compose.yml                  # docker-composeæ–‡ä»¶                     (å¯é€‰ï¼Œæ¨è)
â”œâ”€ Dockerfile                          # dockeræ–‡ä»¶                             (å¯é€‰ï¼Œæ¨è)
```

### 3. é¡¹ç›®æ­å»º - webpacké…ç½®
webpacké…ç½®åŸºäºå…¬ç”¨å’Œå…·ä½“ç¯å¢ƒåˆ†å¼€é…ç½®,è®¾ç½®ä¸Šå°½é‡ç²¾ç®€ã€‚  

webpacké…ç½®ç›®æ ‡ï¼š
> 1. æ³›å«ä¹‰ä¸Šçš„ç‰¹æ€§ï¼ˆlessæ”¯æŒã€å‹ç¼©ã€åˆ†å—ç­‰ï¼‰
> 2. ts/jsæ”¯æŒ
> 3. è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦æ·»åŠ cesiumçš„webpacké…ç½®
> 4. æ ¹æ®æŒ‡ä»¤ä»ä¸åŒå…¥å£æ–‡ä»¶å¯åŠ¨é¡¹ç›®
> 5. ä½¿ç”¨tsconfigä¸­çš„ paths é…ç½®
> 6. é…åˆæ¡†æ¶ä¿å­˜APP_ENV/NODE_ENV/APP_VERSIONç­‰

é…ç½®ä½äº ``config`` æ–‡ä»¶å¤¹ä¸‹ï¼š
```
â”œâ”€ config
|       â”œâ”€config.js                 #æ¯ä¸ªé¡¹ç›®å¸¸è§„éœ€è¦ä¿®æ”¹çš„é…ç½®æ–‡ä»¶ã€‚åŒ…å«ï¼šå¼€å‘ç«¯å£ç­‰
|       â”œâ”€helper.js                 #æä¾›å„ç§å¸®åŠ©å‡½æ•°ï¼Œæ–¹ä¾¿ä¿®æ”¹webpacké…ç½®
|       â”œâ”€run.js                    #æ‰§è¡ŒwebpackæŒ‡ä»¤æ–‡ä»¶
|       â”œâ”€webpack.base.js           #webpackåŸºç¡€é…ç½®æ–‡ä»¶
|       â”œâ”€webpack.dev.js            #webpackå¼€å‘é…ç½®
|       â”œâ”€webpack.prod.js           #webpackç”Ÿäº§é…ç½®
```
æŒ‡ä»¤:ğŸ‘‰ğŸ‘‰ğŸ‘‰
- ``yarn start`` å¯åŠ¨é¡¹ç›®ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- ``yarn build`` é¡¹ç›®æ‰“åŒ…(ç”Ÿäº§ç¯å¢ƒ)ï¼Œ``yarn build:test``é¡¹ç›®æ‰“åŒ…(æµ‹è¯•ç¯å¢ƒ)
- ``build:analyze`` é¡¹ç›®æ‰“åŒ…åˆ†æ
- ``yarn choose [xx]`` å¯åŠ¨ä»¥ã€xxã€‘å¼€å¤´ä¸”ä½äºsrc/examplesæ–‡ä»¶å¤¹ä¸‹çš„æ ·ä¾‹

### 4. é¡¹ç›®å¼€å‘
æä¾›çš„APP_STOREã€å…¬å…±ç»„ä»¶ã€å¯é€‰æ‹“å±•ç­‰ç©å…·å¯å¥½å¥½ç©è€.ğŸ˜€

### 5. é¡¹ç›®DEBUG
vscodeã€chrome æä¾›äº†æ–­ç‚¹/logç­‰å……è¶³çš„Debugå·¥å…· ï¼Œä½†æœ‰æ—¶è¿˜æ˜¯éœ€è¦é…åˆå…¶ä»–å·¥å…·å®Œæˆdebugã€‚  

DEBUGéœ€æ±‚æƒ…æ™¯å¦‚ä¸‹ï¼š
> 1. éœ€è¦ä½¿ç”¨åŸŸåè®¿é—®æœ¬åœ°é¡¹ç›®ã€‚å·¥å…·ï¼š [SwitchHosts](https://www.baidu.com/s?ie=utf-8&f=8&rsv_bp=1&tn=02003390_hao_pg&wd=SwitchHosts&oq=SwitchHosts)
> 2. å¦‚æœapiå’ŒwebåŸŸåç›¸åŒï¼ŒSwitchHostsæ²¡æ³•å®Œæˆï¼Œåªèƒ½ä¸Š nginx (åœ¨___debug_nginx æ–‡ä»¶å¤¹ä¸‹é…ç½®äº†ä¸€äº›åŸºç¡€nginxé…ç½®)
> 3. æµè§ˆå™¨æŠ¥è·¨åŸŸï¼Œåç«¯ä¸æ–¹ä¾¿ä¿®æ”¹ï¼Œå¯ä½¿ç”¨.vscode/launch.json -> runtimeArgs é…ç½®å·²éå®‰å…¨æ¨¡å¼å¯åŠ¨chromeã€‚

### 6. é¡¹ç›®éƒ¨ç½²
é¡¹ç›®ä½¿ç”¨dockeréƒ¨ç½²ï¼Œdockeré…ç½®æ–‡ä»¶åŒ…æ‹¬(``docker-compose.yml``,``Dockerfile``)ï¼Œåœ¨å…·ä½“é¡¹ç›®å¼€å‘æ˜¯å¯æŒ‰éœ€ä¿®æ”¹ ``docker-compose.yml ``é…ç½®å¤–éƒ¨ç«¯å£å’Œ``networks``
//TODOï¼šCICD

![](https://note.youdao.com/yws/public/resource/4e0e610896b6c99a93c33ec3d0ed6b78/xmlnote/DDBF2E299689486D97F09CA5DEA65B12/16226)
